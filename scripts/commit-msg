#!/bin/bash

# Enforce conventional commit standards with scopes
# - Types: feat, fix, docs, style, refactor, perf, test, chore, ci, build, revert
# - Required scope in parentheses
# - Lowercase only
# - First line â‰¤60 characters

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file" | tr -d '\r')
first_line=$(echo "$commit_msg" | head -n1)

# Check length
if [ ${#first_line} -gt 60 ]; then
    echo "error: commit message first line exceeds 60 characters"
    exit 1
fi

# Check lowercase
if [[ "$commit_msg" =~ [A-Z] ]]; then
    echo "error: commit message must be all lowercase"
    echo "please change: \"$commit_msg\""
    echo "to: \"$(echo "$commit_msg" | tr '[:upper:]' '[:lower:]')\""
    exit 1
fi

# Check conventional commit format with scope
if ! [[ "$first_line" =~ ^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)\([a-z-]+\): ]]; then
    echo "error: commit message must follow the format: type(scope): description"
    echo "example: fix(ci): update circleci config"
    echo "your message: \"$first_line\""
    exit 1
fi

exit 0
