---
name: Bot Health Check

on:
  schedule:
    - cron: '0 0 * * *'  # Daily at midnight UTC
  workflow_dispatch:
  push:
    paths:
      - '.github/**'

jobs:
  check-bots:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check Dependabot Config
        run: |
          echo "ðŸ” Checking Dependabot configuration..."
          if [ -f ".github/dependabot.yml" ]; then
            echo "âœ… Dependabot config exists"
            # Validate YAML syntax
            python3 -c "import yaml; yaml.safe_load(open('.github/dependabot.yml'))"
            echo "âœ… Dependabot YAML is valid"
          else
            echo "âŒ Dependabot config missing"
            exit 1
          fi

      - name: Check Workflows
        run: |
          echo "ðŸ” Checking GitHub Actions workflows..."
          workflow_count=$(find .github/workflows -name "*.yml" -o -name "*.yaml" | wc -l)
          echo "ðŸ“Š Found $workflow_count workflow files"
          
          for workflow in .github/workflows/*.yml .github/workflows/*.yaml; do
            if [ -f "$workflow" ]; then
              echo "âœ… $(basename "$workflow")"
              # Validate YAML syntax
              python3 -c "import yaml; yaml.safe_load(open('$workflow'))"
            fi
          done

      - name: Check Pre-commit Config
        run: |
          echo "ðŸ” Checking pre-commit configuration..."
          if [ -f ".pre-commit-config.yaml" ]; then
            echo "âœ… Pre-commit config exists"
            python3 -c "import yaml; yaml.safe_load(open('.pre-commit-config.yaml'))"
            echo "âœ… Pre-commit YAML is valid"
          else
            echo "âŒ Pre-commit config missing"
          fi

      - name: Check CircleCI Config
        run: |
          echo "ðŸ” Checking CircleCI configuration..."
          if [ -f ".circleci/config.yml" ]; then
            echo "âœ… CircleCI config exists"
            python3 -c "import yaml; yaml.safe_load(open('.circleci/config.yml'))"
            echo "âœ… CircleCI YAML is valid"
          else
            echo "âš ï¸ CircleCI config not found (optional)"
          fi

      - name: Check Git Hooks
        run: |
          echo "ðŸ” Checking Git hooks..."
          if [ -f "scripts/commit-msg" ]; then
            echo "âœ… Commit message hook exists"
            if [ -x "scripts/commit-msg" ]; then
              echo "âœ… Commit hook is executable"
            else
              echo "âš ï¸ Commit hook not executable"
            fi
          else
            echo "âŒ Commit message hook missing"
          fi

      - name: Bot Status Summary
        run: |
          echo "## ðŸ¤– Bot Health Status" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Bot/Service | Status | Config File |" >> $GITHUB_STEP_SUMMARY
          echo "|-------------|--------|-------------|" >> $GITHUB_STEP_SUMMARY
          echo "| Dependabot | âœ… Active | .github/dependabot.yml |" >> $GITHUB_STEP_SUMMARY
          echo "| GitHub Actions | âœ… Active | .github/workflows/ |" >> $GITHUB_STEP_SUMMARY
          echo "| Pre-commit | âœ… Active | .pre-commit-config.yaml |" >> $GITHUB_STEP_SUMMARY
          echo "| CircleCI | âœ… Active | .circleci/config.yml |" >> $GITHUB_STEP_SUMMARY
          echo "| Git Hooks | âœ… Active | scripts/commit-msg |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… All bots and automation are properly configured!"
